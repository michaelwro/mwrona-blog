<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Roll and Pitch Angles From Accelerometer Sensors - Michael Wrona&#39;s Blog</title><link rel="icon" type="image/png" href=/favicon.png /><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Roll and Pitch Angles From Accelerometer Sensors" />
<meta property="og:description" content="One of the most important components in control systems for airplanes, fighter jets, quadcopters, and rockets is the AHRS, or Attitude and Heading Reference System. As you can guess, the AHRS tells a system its current attitude orientation and heading. Attitude measurements are typically given as roll and pitch angles, and heading is relative to either magnetic or true north." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mwrona.com/posts/04-accel-roll-pitch/" />
<meta property="article:published_time" content="2020-11-27T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-11-27T00:00:00+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Roll and Pitch Angles From Accelerometer Sensors"/>
<meta name="twitter:description" content="One of the most important components in control systems for airplanes, fighter jets, quadcopters, and rockets is the AHRS, or Attitude and Heading Reference System. As you can guess, the AHRS tells a system its current attitude orientation and heading. Attitude measurements are typically given as roll and pitch angles, and heading is relative to either magnetic or true north."/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel="stylesheet">

	<link rel="stylesheet" type="text/css" media="screen" href="https://mwrona.com/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://mwrona.com/css/main.css" /><link rel="stylesheet" type="text/css" href="https://mwrona.com/css/dark.css"  />
	<link rel="stylesheet" type="text/css" href="https://mwrona.com/css/custom-dark.css"  />

	<script src="https://mwrona.com/js/feather.min.js"></script>
	
	<script src="https://mwrona.com/js/main.js"></script>

	

</head>

<body>
	<div class="container wrapper post">
		<div class="header">
	<h1 class="site-title"><a href="https://mwrona.com/">Michael Wrona&#39;s Blog</a></h1>
	<div class="site-description"><h2>Engineering, coding, tech, and other cool projects!</h2><nav class="nav social">
			<ul class="flat"><a href="https://github.com/michaelwro" title="Github"><i data-feather="github"></i></a></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">All Posts</a>
			</li>
			
			<li>
				<a href="/tags">Post Tags</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post-header">
			<h1 class="title">Roll and Pitch Angles From Accelerometer Sensors</h1>
			<div class="meta">Posted at &mdash; Nov 27, 2020</div>
		</div>

		<div class="markdown">
			<p>One of the most important components in control systems for airplanes, fighter jets, quadcopters, and rockets is the AHRS, or Attitude and Heading Reference System. As you can guess, the AHRS tells a system its current attitude orientation and heading. Attitude measurements are typically given as roll and pitch angles, and heading is relative to either <a href="https://en.wikipedia.org/wiki/Magnetic_declination">magnetic or true north</a>. In order to control a system as complex (and expensive) as airplanes and rockets, a very well-engineered and robust AHRS system is required.</p>
<p>An AHRS consists of three different sensors: a three-axis accelerometer, a three-axis gyroscope, and a three-axis magnetometer. The accelerometer measures accelerations, the gyroscope measures angular rotation rates, and the mangetometer measures magnetic fields (including earth&rsquo;s magnetic field). In addition to accelerations due to movement, the accelerometeter measures gravitational, linear, coriolis, and centripetal accelerations. Since we know gravity&rsquo;s direction is straight down, and its mangitude is 9.81 m/s/s, we can use this knowledge to begin computing orientation!</p>
<h2 id="important-notes">Important Notes</h2>
<ul>
<li><strong>We must assume the accelerometer remains stationary, therfore only measuring acceleration due to gravity.</strong> If the sensor moves/accelerates, the method outlined in this article will no longer be valid. It should still work for most applications, accept dynamics ones.</li>
<li><strong>The accelerometer can only measure roll and pitch angles, not heading.</strong> Gravity is down. No matter the orientation of the accelerometer, it will never be able to measure heading. To put this simply, you can&rsquo;t measure heading with an accelerometer because gravity doesn&rsquo;t depend on heading.</li>
</ul>
<h2 id="derivation">Derivation</h2>

<figure class="center" >
  <a href="/post-imgs/04-accel-roll-pitch/coord-sys.png" target="_blank">
    <img src="/post-imgs/04-accel-roll-pitch/coord-sys.png"  alt="Coordinate System"   width="300px"   style="border-radius: 8px;"  />
  </a>
  
    <figcaption class="center" >Visualization of angles, where (X, Y, Z) is the level frame, and (X&rsquo;, Y&rsquo;, Z&rsquo;) is the tilted frame.</figcaption>
  
</figure>

<p>If we express the gravitational acceleration vector in a level frame, with the +z-axis in the same direction as gravity, it would be:</p>
<p><code>$$\vec{g}_L = \begin{bmatrix} 0 &amp; 0 &amp; g \end{bmatrix}$$</code></p>
<p>Where <code>$g = 9.81m/s^2$</code> and L refers to the level frame (no tilt, completely flat). The accelerometer measurement in a tilted frame will be:</p>
<p><code>$$\vec{a}_T = \begin{bmatrix} a_x &amp; a_y &amp; a_z \end{bmatrix}$$</code></p>
<p>Where T refers to the tilted frame and <code>$a_i$</code> refers to the accelerometer measurement for each axis. In order to describe the orientation of our tilted frame relative to the level one, we will be using Euler angles; more specifically, the 3-2-1 Euler angle set. I included a few resources at the bottom of the page if you need to brush up on them. The 3-2-1 Euler angles are referred to as yaw (<code>$\psi$</code>), pitch (<code>$\theta$</code>), and roll (<code>$\phi$</code>), respectively, and are commonly used in aircraft dynamics and controls. We will use the 3-2-1 Euler angle direction cosine matrix, or DCM, to convert between the tilted frame and level frame. Since we are ignoring yaw/heading measurements, the DCM relationship between the tilted frame and level frame is:</p>
<p><code>$$\begin{pmatrix} a_x \\ a_y \\ a_z \end{pmatrix}_T = \begin{pmatrix} cos\phi &amp; 0 &amp; -sin\theta \\ sin\theta sin\phi &amp; cos\phi &amp; cos\theta sin\phi \\ sin\theta cos\phi &amp; -sin\phi &amp; cos\theta cos\phi \end{pmatrix} \begin{pmatrix} 0 \\ 0 \\ g \end{pmatrix}_L$$</code></p>
<p>If we carry out the matrix-vector multiplications, we get the following equations:</p>
<p><code>$$a_x = g sin\theta$$</code>
<code>$$a_y = -g sin\phi cos\theta$$</code>
<code>$$a_z = -g cos\phi cos\theta$$</code></p>
<p>Using the first equation to solve for <code>$\theta$</code>, we get:</p>
<p><code>$$Pitch = \theta = arcsin \frac{a_x}{g}$$</code></p>
<p>Using the second and third equations to solve for <code>$\phi$</code>, and noting that <code>$tan = \frac{sin}{cos}$</code>, we get:</p>
<p><code>$$Roll = \phi = arctan \frac{a_y}{a_z}$$</code></p>
<p>Using the fact that <code>$g = \sqrt{a_x^2 + a_y^2 + a_z^2}$</code> for a stationary sensor, we arrive at the two final expressions:</p>
<hr>
<p><code>$$Pitch = \theta = arcsin \frac{a_x}{g} = arcsin \frac{a_x}{\sqrt{a_x^2 + a_y^2 + a_z^2}}$$</code>
<code>$$Roll = \phi = arctan \frac{a_y}{a_z}$$</code></p>
<hr>
<p>Using these two expressions, we can convert accelerometer measurements into roll and pitch angles!</p>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Euler_angles">&ldquo;Euler Angles.&quot;</a> <em>Wikipedia: The Free Encyclopedia.</em> 26 November 2020. Web. Accessed 27 November 2020.</li>
<li><a href="http://www.chrobotics.com/library/understanding-euler-angles">&ldquo;Understanding Euler Angles.&quot;</a> <em>CH Robotics</em> 2020. Web. Accessed 27 November 2020.</li>
<li><a href="https://www.youtube.com/watch?v=Zep-4pdVRyc">&ldquo;Spacecraft Dynamics &amp; Control - 2.2.1 - Directional Cosine Matrices - Definitions.&quot;</a> <em>YouTube</em>, uploaded by Bob Trenwith, 25 November 2018.</li>
<li><a href="https://en.wikiversity.org/wiki/PlanetPhysics/Direction_Cosine_Matrix">&ldquo;PlanetPhysics/Direction Cosine Matrix.&quot;</a> <em>Wikiversity</em>, 13 September 2020. Web. Accessed 27 November 2020.</li>
</ul>

		</div>

		<div class="post-tags">
			
				
					<nav class="nav tags">
							<ul class="flat">
								
								<li><a href="/tags/control-theory">control theory</a></li>
								
								<li><a href="/tags/sensors">sensors</a></li>
								
							</ul>
					</nav>
				
			
		</div>
		</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> Copyright Â© Michael Wrona 2020 |  Powered by <a href="https://gohugo.io">Hugo</a> and the <a href="https://github.com/vividvilla/ezhil">Ezhil theme</a></div>
	</nav>
</div>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-176773333-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<script>feather.replace()</script><script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$','$$'], ['\\[', '\\]']],
        processEscapes: true,
        processEnvironments: true,
        tags: 'ams'
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
  
    window.addEventListener('load', (event) => {
        document.querySelectorAll("mjx-container").forEach(function(x){
          x.parentElement.classList += 'has-jax'})
      });
  
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

</body>
</html>
