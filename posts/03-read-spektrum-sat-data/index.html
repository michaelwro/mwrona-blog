<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Read Serial Data From Spektrum Remote Receiver - Michael Wrona&#39;s Blog</title><link rel="icon" type="image/png" href=/favicon.png /><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Read Serial Data From Spektrum Remote Receiver" />
<meta property="og:description" content="About six years ago, I purchased a Spektrum DX6i RC plane transmitter to fly my RC planes with. Unfortunately, life got busier and my interests shifted, which sent my planes and controller to retire in the basement. When the idea to build a quadcopter flight controller began to come to fruition, I knew my DX6i controller would be perfect!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mwrona.com/posts/03-read-spektrum-sat-data/" />
<meta property="article:published_time" content="2020-09-02T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-09-02T00:00:00+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Read Serial Data From Spektrum Remote Receiver"/>
<meta name="twitter:description" content="About six years ago, I purchased a Spektrum DX6i RC plane transmitter to fly my RC planes with. Unfortunately, life got busier and my interests shifted, which sent my planes and controller to retire in the basement. When the idea to build a quadcopter flight controller began to come to fruition, I knew my DX6i controller would be perfect!"/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel="stylesheet">

	<link rel="stylesheet" type="text/css" media="screen" href="https://mwrona.com/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://mwrona.com/css/main.css" /><link rel="stylesheet" type="text/css" href="https://mwrona.com/css/dark.css"  />
	<link rel="stylesheet" type="text/css" href="https://mwrona.com/css/custom-dark.css"  />

	<script src="https://mwrona.com/js/feather.min.js"></script>
	
	<script src="https://mwrona.com/js/main.js"></script>

	<script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$','$$'], ['\\[', '\\]']],
        processEscapes: true,
        processEnvironments: true
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
  
    window.addEventListener('load', (event) => {
        document.querySelectorAll("mjx-container").forEach(function(x){
          x.parentElement.classList += 'has-jax'})
      });
  
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>

<body>
	<div class="container wrapper post">
		<div class="header">
	<h1 class="site-title"><a href="https://mwrona.com/">Michael Wrona&#39;s Blog</a></h1>
	<div class="site-description"><h2>Engineering, coding, tech, and other cool projects!</h2><nav class="nav social">
			<ul class="flat"><a href="https://github.com/michaelwro" title="Github"><i data-feather="github"></i></a></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">All Posts</a>
			</li>
			
			<li>
				<a href="/tags">Post Tags</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post-header">
			<h1 class="title">Read Serial Data From Spektrum Remote Receiver</h1>
			<div class="meta">Posted at &mdash; Sep 2, 2020</div>
		</div>

		<div class="markdown">
			<p>About six years ago, I purchased a <a href="https://www.spektrumrc.com/Products/Default.aspx?ProdId=SPM6630">Spektrum DX6i</a> RC plane transmitter to fly my RC planes with. Unfortunately, life got busier and my interests shifted, which sent my planes and controller to retire in the basement. When the idea to build a quadcopter flight controller began to come to fruition, I knew my DX6i controller would be perfect! &ldquo;This is a cause worth coming out of retirement for, old one&rdquo; I said to my controller. His response: not powering on. I guess it&rsquo;s time for some fresh AA&rsquo;s.</p>
<h2 id="introduction">Introduction</h2>
<p>I was initially going to use my <a href="https://www.spektrumrc.com/Products/Default.aspx?ProdId=SPMAR6210">Spektrum AR6210 6-channel receiver</a> to provide pilot inputs to my quadcopter. I&rsquo;d use my microcontroller&rsquo;s digital pins to read the <a href="https://en.wikipedia.org/wiki/Pulse-width_modulation">PWM signals</a> from each channel. Unfortuantely, reading six PWM channels would require six individual servo cables running from the receiver to the microcontroller, which would look messy and add extra weight to the drone. Since this was basically my only option given the materials I had, I was willing to compromise.</p>
<p>I had always wondered what the little dongle-thingy was attached to my AR6210 receiver. I did some research and discovered this was a <a href="https://www.spektrumrc.com/Products/Default.aspx?ProdID=SPM9645">Spektrum DSMX Remote Receiver</a>. I did some more digging and found out that the three wires connecting the Remote Receiver to the AR6210 were power (+3.3V, orange), data (gray), and ground (black) wires. It turns out that the connection between the two was a serial connection that contained channel data! After this amazing discovery, I began reverse engineering the DSMX communication protocol and eventually succeeded: I figured out how to extract the six channel/transmitter stick positions from the DSMX serial byte stream. Now, time to tell you how to do the same!</p>

<figure class="center" >
  <a href="/post-imgs/03-read-spektrum-sat-data/rem-rec-and-rc-rec.jpg" target="_blank">
    <img src="/post-imgs/03-read-spektrum-sat-data/rem-rec-and-rc-rec.jpg"  alt="Remote Receiver and RC Receiver"   width="400px"   style="border-radius: 8px;"  />
  </a>
  
    <figcaption class="center" >Spektrum Remote Receiver and AR6210 RC Receiver.</figcaption>
  
</figure>

<p>First, I&rsquo;ll describe the DSMX communication protocol and serial packet structure. Next, I&rsquo;ll outline my hardware testing setup and wiring. Finally, I&rsquo;ll dive deep into the Arduino code I developed to read and process the remote receiver&rsquo;s serial data stream.</p>
<h2 id="dsmx-communication-protocol">DSMX Communication Protocol</h2>
<p><strong>Datasheet Reference:</strong> The official data sheet describing the Spektrum Remote Receiver communication protol can be found <a href="https://www.spektrumrc.com/ProdInfo/Files/Remote%20Receiver%20Interfacing%20Rev%20A.pdf">at this link</a>.</p>
<p>The serial communication protocol used by Spektrum Remote Receivers consists of 16-byte transmission packets. There are four different serial communication protocols used by the receivers, differentiated by the timing between transmissions and channel data ranges.</p>
<table>
<thead>
<tr>
<th align="left">Protocol</th>
<th align="center">ID Byte</th>
<th align="center">TX Timing</th>
<th align="center">Ch. Data Range</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><strong>11ms/2048 DSM2</strong></td>
<td align="center">0x12</td>
<td align="center">11ms</td>
<td align="center">0 &hellip; 2048</td>
</tr>
<tr>
<td align="left"><strong>22ms/1024 DSM2</strong></td>
<td align="center">0x01</td>
<td align="center">22ms</td>
<td align="center">0 &hellip; 1024</td>
</tr>
<tr>
<td align="left"><strong>11ms/2048 DSMX</strong></td>
<td align="center">0xB2</td>
<td align="center">11ms</td>
<td align="center">0 &hellip; 2048</td>
</tr>
<tr>
<td align="left"><strong>22ms/2048 DSMX</strong>*</td>
<td align="center">0xA2</td>
<td align="center">22ms</td>
<td align="center">0 &hellip; 2048</td>
</tr>
</tbody>
</table>
<p>The timing between each serial data packet transmission is either 11ms or 22ms, and the channel data ranges from zero to either 1024 or 2048. <strong>My particular Remote Receiver used the 22ms/2048 DSMX (denoted by *) protocol.</strong> I am assuming this is the most common.</p>
<h3 id="packet-structure">Packet Structure</h3>
<p>Each 16-byte serial data packet has the following structure:</p>


<table>
    <tr>
        <th>Byte Index</th>
        <td>0</td>
        <td>1</td>
        <td>2 ... 15</td>
    </tr>
    <tr>
        <th>Field Name</th>
        <td>Fades</td>
        <td>Proto. ID</td>
        <td>ServoData[7]</td>
    </tr>
    <tr>
        <th>Data Type</th>
        <td>uint8_t</td>
        <td>uint8_t</td>
        <td>uint16_t</td>
    </tr>
</table>

<p>The first byte in the transmission is referred to as &lsquo;fades&rsquo; in Spektrum&rsquo;s datasheet. This is a count of how many data packets were missed by the remote receiver. My receiver never missed any frames during testing (even when I did a range test), so I guess there&rsquo;s no need to keep track of this value in your code. This byte is an unsigned 8-bit value. The second byte is the protocol ID byte. This important byte&rsquo;s value indicates which protocol the remote receiver uses. This byte is an unsigned 8-bit value. Finally, the remaining 14 bytes in the serial packet describe the seven channel&rsquo;s values/positions. These are <a href="https://en.wikipedia.org/wiki/Endianness">big-endian</a> unsigned 16-bit values. Therefore, each channel&rsquo;s data is in groups of two 8-bit unsigned values. Each of these groups have the following bit-structure:</p>


<table>
    <tr>
        <th>Bit 15</th>
        <td>Channel phase</td>
    </tr>
    <tr>
        <th>Bits 14 - 11</th>
        <td>Channel ID</td>
    </tr>
    <tr>
        <th>Bits 10 - 0</th>
        <td>Channel Value</td>
    </tr>
</table>

<p>This will begin to make more sense when I describe my data processing code down below.</p>
<h2 id="hardware-setup-and-wiring">Hardware Setup and Wiring</h2>
<h3 id="custom-plug-adapter">Custom Plug Adapter</h3>
<p>In order to make the remote receiver breadboard-compatible, I needed to make my own custom adapter. I bought a additional <a href="https://www.amazon.com/gp/product/B000ND6IXW/ref=ppx_yo_dt_b_asin_title_o07_s00?ie=UTF8&amp;psc=1">remote receiver cable</a> and soldered its wires to the wires of a standard servo connector (see image below).</p>

<figure class="center" >
  <a href="/post-imgs/03-read-spektrum-sat-data/rec-wire-conv.jpg" target="_blank">
    <img src="/post-imgs/03-read-spektrum-sat-data/rec-wire-conv.jpg"  alt="Custom wire adaptor."   width="400px"   style="border-radius: 8px;"  />
  </a>
  
    <figcaption class="center" >Custom adapter to convert the remote receiver connector to a standard servo plug.</figcaption>
  
</figure>

<p>When it came time to</p>
<p>In order to determine which protocol my remote receiver used, I probed its serial output via a serial-to-USB converter and serial port monitoring software.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->

		</div>

		<div class="post-tags">
			
				
					<nav class="nav tags">
							<ul class="flat">
								
								<li><a href="/tags/arduino">arduino</a></li>
								
								<li><a href="/tags/circuits">circuits</a></li>
								
								<li><a href="/tags/cpp">cpp</a></li>
								
								<li><a href="/tags/drone">drone</a></li>
								
							</ul>
					</nav>
				
			
		</div>
		</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> Copyright © Michael Wrona 2020 |  <a href="https://github.com/vividvilla/ezhil">Ezhil theme</a> | Built with <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-176773333-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<script>feather.replace()</script>
</body>
</html>
